---
title: "Penugasan Praktikum 4"
author: "Muhammad Rayhan Faridh"
date: "2024-10-21"
output: word_document
---

Siapkan library yang akan digunakan
```{r}
library(readxl)
library(car)
library(MVN)
```

Keberhasilan suatu pembangunan di suatu daerah dapat dilihat dari beberapa indikator, diantaranya adalah Indeks Pembangunan Manusia (IPM) dan lajupertumbuhan ekonomi. Pemerintah RI menetapkan target dalam RPJMN 2020-2024 IPM sebesar 63,94 dan laju pertumbuhan ekonomi di Provinsi Papua sebesar 4,7 persen. Tahun 2022 diperoleh data sebagai berikut.
```{r}
# Data IPM di Papua tahun 2022
IpmPapua <- read.csv("./IPM Papua 2022.csv", sep=";")
IpmPapua

# Data Laju Pertumbuhan ekonomi di Papua tahun 2022
lpe <- read.csv("./Laju Pertumbuhan Ekonmi Papua 2022.csv", sep=";")
lpe

# Data gabungan
data <- data.frame(
  ipm = as.numeric(IpmPapua[[2]]),
  laju = as.numeric(lpe[[2]])
)
data
```

Apakah hasil pembangunan di Provinsi Papua pada Tahun 2020 tersebut sudah mencapai target yang ditetapkan? Untuk menjawabnya lakukan langkah-langkah berikut ini.


1.  Apakah data mengandung outlier? Buatlah chi-square plot untuk mendeteksinya
```{r}
n <- dim(data)[1] # baris
p <- dim(data)[2] # kolom
n
p

# Hitung vector rata-rata
xbar <- apply(data,2,mean)
xbar

# Hitung Square Generalized Distance
d2 <- mahalanobis(data,xbar,cov(data))
d2

dist.order <- sort(d2) # ordering square distance
dist.order

# Quantile-chisquare q((j-0.5)/n)
Q <- matrix(rep(0,n),n,1)
for (j in 1:n) {
  Q[j,]=qchisq((j-0.5)/n,df=p)
}

# Chi-square plot
scatterplot(Q, dist.order, grid=FALSE,regLine=FALSE,smooth=FALSE,
            boxplot="",pch=16,xlab=expression(paste(chi[p]^2, "quantile")),ylab="ordered distance")
abline(a=0,b=1, col="red")
```
Berdasarkan gambar chi-square plot tersebut, terdeteksi adanya data outlier multivariate.


2.  Lakukan uji multivariate normal dan apa yang terjadi jika data
    outlier dibuang?

Hipotesis :

H0 : Data berdistribusi multivariate normal

H1 : Data tidak berdistribusi multivariate normal

```{r }
UjiRoy <- mvn(data, mvnTest = "royston")
UjiRoy
```
Berdasarkan output di atas, didapatkan p-value = 1.063874e-06 \< 0.05 (Tolak H0). Dapat disimpulkan bahwa dengan tingkat signifikansi 5%, data tidak berdistribusi multivariate normal.

Dapat pula cek dengan kesimetrisan data menggunakan Uji Mardia

Hipotesis :

H0 : Data simetris

H1 : Data tidak simetris

```{r}
UjiMar <- mvn(data, mvnTest = "mardia")
UjiMar
```
Berdasarkan output di atas, didapatkan p-value dari mardia skewness adalah 3.43941866493253e-10 \< 0.05 (Tolak H0). Oleh karena itu, dapat disimpulkan bahwa dengan tingkat signifikansi 5%, data tidak simetris.

```{r}
# iqr ipm
Q1_ipm <- quantile(data$ipm, 0.25)
Q3_ipm <- quantile(data$ipm, 0.75)
IQR_ipm <- IQR(data$ipm)

# batas atas dan  bawah
bb_ipm <- Q1_ipm - 1.5 * IQR_ipm
ba_ipm <- Q3_ipm + 1.5 * IQR_ipm

clean_ipm <- data[data$ipm >= bb_ipm & data$ipm <= ba_ipm, ]
clean_ipm

# iqr laju
Q1_laju <- quantile(data$laju, 0.25)
Q3_laju <- quantile(data$laju, 0.75)
IQR_laju <- IQR(data$laju)

# batas atas dan  bawah
bb_laju <- Q1_laju - 1.5 * IQR_laju
ba_laju <- Q3_laju + 1.5 * IQR_laju

# data tanpa outlier dan akan digunakan dalam pengujian di nomor-nomor berikutnya
datafix <- clean_ipm[clean_ipm$laju >= bb_laju & clean_ipm$laju <= ba_laju, ]
datafix 
```
Untuk memastikan apakah data sudah berdistribusi multivariate normal, maka uji kembali dengan uji Roy dan cek kenormalan masing-masing data dengan shapiro test

```{r}
shapiro.test(datafix$ipm)
shapiro.test(datafix$laju)

UjiRoy1 <- mvn(datafix, mvnTest = "royston")
UjiRoy1
```
Berdasarkan perhitungan di atas, ketika outlier dibuang didapatkan bahwa data akan berdistribusi multivariate normal.

3.  Setelah permasalahan outlier ditangani, tuliskan hipotesis penelitiannya, lakukan prosedur pengujian hipotesisnya dan buatlah ellipsoid daerah penerimaan H0 pada taraf α=5%

**Hipotesis :**

H0 : miu = (63.94, 4.7)

H1 : miu ≠ (63.94, 4.7)

Pengujian hipotesis dilakukan dengan uji statistik T2 Hotelling

```{r}
# Function T2 Hotelling
T.test <- function(X, mu=0){ 
  X <- as.matrix(datafix) 
  n1 <- nrow(X)  
  p1 <- ncol(X)  
  df2 <- n1 - p1 
  
  if(df2 < 1L) stop("Need nrow(X) > ncol(X).") 
  if(length(mu) != p1) mu <- rep(mu[1], p1) 
  
  xbar <- colMeans(X) 
  S <- cov(X) 
  T2 <- n1 * t(xbar - mu) %*% solve(S) %*% (xbar - mu) 
  Fstat <- T2 / (p1 * (n1-1) / df2) 
  pval <- 1 - pf(Fstat, df1=p1, df2=df2) 
  data.frame(T2=as.numeric(T2), Fstat=as.numeric(Fstat),
             df1=p1, df2=df2, p.value=as.numeric(pval), row.names="") 
}
```

```{r}
# rata-rata sampel
xbar <- apply(data,2,mean)
xbar
mu <- c(63.94,4.7)

# Perhitungan T2 Hotteling 
T.test(datafix,mu)
```

Untuk menghitung statistik uji dan p-value dapat digunakan juga fungsi
"lm"

```{r}
y <- as.matrix(datafix) - matrix(c(63.94,4.7),nrow(datafix),ncol(datafix),byrow=T) 
y

model <- anova(lm(y ~ 1)) 
model 
```

**Hitung nilai kritis penolakan H0**

```{r}
n1 <- nrow(datafix)  
p1 <- ncol(datafix)


alpha <- 0.05 
c2 <- (n1 - 1) * p1 * qf(1-alpha, df1=p1, df2=n1-p1)/(n1-p1) 
c2 
```
Berdasarkan output R tersebut, didapatkan vektor rata-rata sampel dari p=2 variable adalah:

ipm laju

58.493793 3.844828

Jika α=0.05, nilai c2=(n-1)*p*(Fp(n-p;1-α))/(n-p)=6.997188.

Nilai T2 Hotelling diperoleh sebesar 32.37043.

Oleh karena nilai T2 Hotelling \< (n-1)p(Fp,n-p;1-α)/(n-p), atau p-value=3.558905e-05 \< α=0.05 kesimpulannya tolak H0, artinya hasil pembangunan di Provinsi Papua pada Tahun 2022 belum mencapai target yang ditetapkan.

**Membuat Confidence Region Ellipsoid**

```{r}
cov12 <- cov(datafix[,1], datafix[,2])
cov12  
var11 <- var(datafix[,1])
var22 <- var(datafix[,2])
sig <- matrix(c(var11, cov12, cov12, var22), ncol=2, byrow=F)
sig

```

```{r}
S <- cov(datafix) 
library(car) 
alpha <- 0.05 
tconst <- sqrt((p1/n1)*((n1-1)/(n1-p1)) * qf(1-alpha,p1,n1-p1)) 
id <- c(1,2) 
plot(ellipse(center=xbar[id], shape=S[id,id], radius=tconst, 
draw=F),type="n", xlab="ipm", ylab="laju", ylim=c(3.2,5)) 
lines(ellipse(center=xbar[id], shape=S[id,id], radius=tconst, 
lwd=3), xlab="ipm", ylab="laju") 
points(63.94, 4.7,col="red", pch=16) 
text(mu[1]-0.5,mu[2],expression(mu[0])) 
text(xbar[1]+0.5,xbar[2],expression(bar(x)))

```
Berdasarkan gambar ellipsoid di atas, mu 0 berada di luar daerah penerimaan H0, kesimpulannya tolak H0.

4.  Buatlah simultan confidence intervalnya
```{r}
T_ci <- function(mu, Sigma, n, avec=rep(1,length(mu)),level=0.95) {  
  p <- length(mu)  
  if(nrow(Sigma)!=p) stop("Need length(mu) == nrow(Sigma).")  
  if(ncol(Sigma)!=p) stop("Need length(mu) == ncol(Sigma).")  
  if(length(avec)!=p) stop("Need length(mu) == length(avec).")  
  if(level <=0 | level >= 1) stop("Need 0 < level < 1.")  
  cval <- qf(level, p1, n1-p1) * p1 * (n1-1) / (n1-p1)  
  zhat <- crossprod(avec, mu)  
  zvar <- crossprod(avec, Sigma %*% avec) / n1  
  const <- sqrt(cval * zvar)  
  c(lower = zhat - const, upper = zhat + const)  
}  

T_ci(mu=xbar, Sigma=S, n=n1, avec=c(1,0)) #CI untuk mu_0 ipm

T_ci(mu=xbar, Sigma=S, n1, avec=c(0,1)) ##CI untuk mu_0 laju
```
Didapatkan confidence interval untuk IPM,  yaitu berada di antara 53.14 hingga 63.85. Sedangkan untuk Laju pertumbuhan ekonomi, yaitu berada di antara 3.21 hingga 4.8.

5.  Apa kesimpulan Anda?

Berdasarkan perhitungan di atas, didapatkan bahwa hasil pembangunan di Provinsi Papua pada tahun 2022 belum mencapai target RPJMN 2020-2024. Hal ini dilihat dapat dilihat dari IPM dan Laju perekonomian di Papua 2022 yang masih berada di bawah angka yang sudah ditetapkan oleh pemerintah.